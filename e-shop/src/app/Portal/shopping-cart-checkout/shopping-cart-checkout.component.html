<div class="container main-contant py-5">
  <h1 class="text-center mb-3 text-secondary">E-Shop 結帳</h1>
  <section class="form-row align-items-center text-center">
    <div class="col">
      <div class="alert alert-success alert-rounded mb-0" role="alert">
        1.輸入訂單資料
      </div>
    </div>
    <div class="col">
      <div class="alert alert-light alert-rounded mb-0" role="alert">
        2.金流付款
      </div>
    </div>
    <div class="col">
      <div class="alert alert-light alert-rounded mb-0" role="alert">
        3.完成
      </div>
    </div>
  </section>

  <section class="row justify-content-center mt-5">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header" id="headingOne">
          <h6 class="mb-0 d-flex align-items-center">
            <button
              type="button"
              class="btn btn-primary"
              (click)="isCollapsed = !isCollapsed"
              [attr.aria-expanded]="!isCollapsed"
              aria-controls="collapseBasic"
            >
              購物明細
              <i
                class="fa fa-angle-down"
                aria-hidden="true"
                *ngIf="isCollapsed"
              ></i>
              <i
                class="fa fa-angle-up"
                aria-hidden="true"
                *ngIf="isCollapsed === false"
              ></i>
            </button>
            <span class="h3 ml-auto mb-0">{{
              finalTotalAmount | currency: "TWD":"symbol":"1.0-0"
            }}</span>
          </h6>
        </div>
      </div>
      <div id="collapseBasic" [collapse]="isCollapsed">
        <table class="table table-sm">
          <thead>
            <tr>
              <th width="30"></th>
              <th width="100"></th>
              <th>商品名稱</th>
              <th width="100">數量</th>
              <th width="80">小計</th>
            </tr>
          </thead>
          <tbody>
            <!-- 商品資訊 -->
            <tr *ngFor="let item of carts">
              <td class="align-middle text-center">
                <!-- 刪除商品 -->
                <button
                  type="button"
                  class="btn btn-outline-secondary btn-sm"
                  [swal]="deleteSwal"
                >
                  <i class="fa fa-trash-o"></i>
                </button>
                <swal
                  #deleteSwal
                  title="確定移除 {{ getProduct(item.product).title }} ?"
                  text="從購物車移除商品"
                  [showCancelButton]="true"
                  [focusCancel]="true"
                  (confirm)="removeFromCart(item.cartDetailId)"
                ></swal>
              </td>
              <td class="align-middle">
                <img
                  [src]="getProduct(item.product).imageUrl"
                  alt="產品圖片"
                  class="img-fluid img-thumbnail"
                />
              </td>
              <td class="align-middle">
                <a
                  [routerLink]="['/portal/product']"
                  [queryParams]="{
                    productId: getProduct(item.product).productId
                  }"
                  >{{ getProduct(item.product).title }}</a
                >
              </td>
              <td class="align-middle">
                {{ item.qty }} {{ getProduct(item.product).unit }}
              </td>
              <td class="align-middle text-right">
                {{
                  getShoppingItemPrice(item) | currency: "TWD":"symbol":"1.0-0"
                }}
              </td>
            </tr>

            <!-- 運費 -->
            <tr>
              <td colspan="4" class="text-right">運費</td>
              <td class="text-right">
                <strong>$0</strong>
              </td>
            </tr>

            <!-- 合計 -->
            <tr *ngIf="finalTotalAmount !== totalAmount">
              <td colspan="4" class="text-right text-success">合計</td>
              <td class="text-right text-success">
                <strong>{{
                  finalTotalAmount | currency: "TWD":"symbol":"1.0-0"
                }}</strong>
              </td>
            </tr>
            <tr *ngIf="finalTotalAmount === totalAmount">
              <td colspan="4" class="text-right">合計</td>
              <td class="text-right">
                <strong>{{
                  totalAmount | currency: "TWD":"symbol":"1.0-0"
                }}</strong>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <h5 class="py-3 mt-5 mb-2 text-center bg-light">訂購人資訊</h5>
      <form #userOrderInfoForm="ngForm">
        <div class="form-row">
          <!-- 姓名 -->
          <div class="form-group col-md-6">
            <label for="username">姓名</label>
            <input
              type="text"
              class="form-control"
              id="username"
              name="username"
              placeholder="姓名"
              required
              [(ngModel)]="userInfo.UserName"
            />
            <div class="invalid-feedback">請輸入姓名</div>
          </div>
          <!-- Email -->
          <div class="form-group col-md-6">
            <label for="email">Email</label>
            <input
              type="email"
              class="form-control"
              id="email"
              name="email"
              placeholder="Email"
              required
              [(ngModel)]="userInfo.Email"
            />
            <div class="invalid-feedback">請輸入正確的 Email</div>
          </div>
        </div>
        <div class="form-row">
          <!-- 國家 -->
          <div class="form-group col-md-4">
            <label for="country">國家</label>
            <select
              id="country"
              name="country"
              class="form-control"
              [(ngModel)]="userInfo.Country"
              (ngModelChange)="setCityListData($event)"
              required
            >
              <option disabled [ngValue]="null">請選擇</option>
              <option
                *ngFor="let country of countryList"
                [ngValue]="country.value"
              >
                {{ country.text }}
              </option>
            </select>
          </div>
          <!-- 城市 -->
          <div class="form-group col-md">
            <label for="city">城市</label>
            <select
              id="city"
              name="city"
              class="form-control"
              [(ngModel)]="userInfo.City"
              required
            >
              <option disabled [ngValue]="null">請選擇</option>
              <option *ngFor="let city of cityList" [ngValue]="city.value">
                {{ city.text }}
              </option>
            </select>
          </div>
          <!-- 郵遞區號 -->
          <div class="form-group col-md">
            <label for="zipcode">郵遞區號</label>
            <input
              type="text"
              class="form-control"
              id="zipcode"
              name="zipcode"
              [(ngModel)]="userInfo.ZipCode"
            />
          </div>
        </div>
        <!-- 地址 -->
        <div class="form-group">
          <label for="inputAddress">地址</label>
          <input
            type="text"
            class="form-control"
            id="address"
            name="address"
            placeholder="中正路一段123號"
            required
            [(ngModel)]="userInfo.Address"
          />
          <div class="invalid-feedback">請輸入地址</div>
        </div>
        <!-- 下一步 -->
        <div class="text-right">
          <!-- 重新填寫 -->
          <button
            type="button"
            class="btn btn-secondary mr-2"
            (click)="resetUserInfo()"
          >
            重新填寫
          </button>

          <!-- 繼續選購 -->
          <a [routerLink]="['/portal/products']" class="btn btn-secondary mr-2"
            >繼續選購</a
          >

          <!-- 確認付款 -->
          <button
            type="button"
            class="btn btn-primary"
            *ngIf="carts.length !== 0"
            [disabled]="userOrderInfoForm.form.valid === false"
            (click)="nextStep()"
          >
            確認付款
          </button>
          <!-- <a href="" class="btn btn-primary"
            >確認付款</a
          > -->
        </div>
      </form>
    </div>
  </section>
</div>
